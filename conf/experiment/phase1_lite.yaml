# Developer: inkbytefo
# Modified: 2025-11-07
#
# @package _group_
#
# Phase 1 Lite (Morpho-Semantic Enriched, Small-Scale)
#
# Purpose:
#   Morphological + semantic enrichment ON with AgglutinativeAttention.
#   Directly comparable to phase1_baseline on the SAME Turkish corpus.
#   Target hardware:
#     - Single NVIDIA T4 14GB GPU

defaults:
  - _self_

model:
  # Lite backbone for faster experimentation on T4
  d_model: 256
  n_layers: 4
  n_heads: 4
  d_ff: 1024

  # Single morpho-aware language expert
  n_experts: 1
  expert_types: ["language"]

  # No memory / multimodal in this ablation
  memory_size: 0
  max_seq_len: 256

  use_linear_attention: false
  use_memory: false
  use_introspection: false
  use_multimodal: false

  # Morpho+semantic enriched LanguageExpert
  use_agglutinative_attention: true
  morphological_analysis: true

  # Tokenizer
  tokenizer_path: tokenizer/morphopiece.model

training:
  # Tuned for 1x T4 14GB (smaller model → can use same batch size)
  batch_size: 32
  epochs: 3
  max_steps: 30000
  gradient_accumulation_steps: 1

  learning_rate: 0.0003
  warmup_steps: 1000

  optimizer: adamw
  adam_beta1: 0.9
  adam_beta2: 0.999
  adam_epsilon: 1.0e-8
  weight_decay: 0.01

  use_amp: true
  use_gradient_checkpointing: true

  log_interval: 100
  eval_interval: 1000
  save_interval: 5000

  checkpoint_dir: checkpoints/phase1_lite
  keep_last_n_checkpoints: 3

# Data config for this experiment:
data:
  data_path: data/turkish_corpus/turkish_corpus_phase1.jsonl
  data_dir: null
  val_data_path: null
  train_split: 0.95
  num_workers: 4
  pin_memory: true
  persistent_workers: true

experiment_name: phase1_lite
run_name: phase1_lite_${now:%Y%m%d_%H%M%S}

# ------------------------------------------------------------------
# STARTING COMMANDS (1x T4 14GB, A/B TEST)
#
# Baseline (Morpho OFF, Agglutinative OFF):
#   python train.py \
#     experiment=phase1_baseline
#
# Morpho-Semantic Lite (Morpho ON, Agglutinative ON):
#   python train.py \
#     experiment=phase1_lite
#
# Notlar:
# - Her iki config zaten:
#     data.data_path = data/turkish_corpus/turkish_corpus_phase1.jsonl
#     tokenizer_path = tokenizer/morphopiece.model
# - Değerlendirme:
#     PPL_baseline = exp(Validation/main_loss_baseline)
#     PPL_morpho   = exp(Validation/main_loss_morpho)
#     ΔPPL ve ΔPPL% hesaplanarak morfo-semantik katkı kantitatif raporlanır.
# ------------------------------------------------------------------